/* JS omitted for brevity in thought, but I'll use the full content from view_file */
